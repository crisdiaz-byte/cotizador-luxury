import streamlit as st
import pandas as pd
from datetime import datetime

# Configuración de página para Móvil
st.set_page_config(page_title="Cotizador Luxury", layout="centered")

# --- LISTA DE TELAS (Extraídas de tu lista) ---
telas_lista = [
    "?.?. 500", "?.?. IPANEMA", "B.O. LONG BEACH", "B.O. LUXURY", "B.O. MONTREAL", 
    "B.O. SIDNEY", "B.O. BUDELLI", "BO TEXTURE", "BO OHIO", "DUO BASIC", 
    "DUOLINE DIM OUT", "DUO WOODLINE", "DUO CELEBRITY", "DUO DIM OUT SOFT", 
    "DUO TERRA", "DUO BRIGHT", "DUO DIM OUT WOODS", "DUO SEASON", "F.L. IPANEMA", 
    "F.L. LONG BEACH", "F.L SIDNEY", "F.L. BUDELLI", "SCREEN BASIC", "SCREEN SOFT", 
    "SCREEN MILAN", "SCREEN ONE", "GALAXY BLACK OUT", "F.L. BERLIN", "SHEER ADVANTAGE", 
    "DUO DENSE WOODLOOK", "DUO ROYAL DIM OUT", "DUO LINO DIM OUT", "DUO GENIUS DIM OUT", 
    "Duo Radiance", "Dim out Glam", "Fl Fresh", "Bo Stylus", "Brave"
]

st.title("?? Cotizador Luxury HMG")

# --- PANEL LATERAL: CONFIGURACIÓN ---
with st.sidebar:
    st.header("Configuración del Pedido")
    cliente = st.text_input("Nombre del Cliente")
    margen = st.number_input("Margen de Utilidad (%)", value=40.0)
    instalacion = st.number_input("Costo Instalación ($)", value=0.0)
    otros = st.number_input("Otros (Andamios/Comisión)", value=0.0)

# --- PESTAÑAS ---
tab1, tab2 = st.tabs(["Nueva Cotización", "Historial"])

with tab1:
    st.subheader("1. Cargar datos de Fábrica")
    archivo = st.file_uploader("Sube el Excel de Fábrica", type=['xlsx', 'csv'])
    
    if archivo:
        df = pd.read_excel(archivo) if archivo.name.endswith('xlsx') else pd.read_csv(archivo)
        st.write("Datos recibidos:")
        st.dataframe(df)
        
        # Lógica de cálculo
        # Asumimos que el Excel tiene una columna llamada 'Costo'
        if 'Costo' in df.columns:
            df['Precio Venta'] = df['Costo'] * (1 + (margen / 100))
            total_telas = df['Precio Venta'].sum()
            total_final = total_telas + instalacion + otros
            
            st.success(f"### Total Cliente Final: ${total_final:,.2f}")
            
            if st.button("Guardar y Generar PDF"):
                # Aquí se guardaría en el historial (Sheets)
                st.info("Guardando en base de datos...")
                # Lógica simplificada de guardado
                nuevo_registro = pd.DataFrame([{
                    "Fecha": datetime.now(),
                    "Cliente": cliente,
                    "Total": total_final,
                    "Utilidad %": margen
                }])
                st.write("Registro guardado con éxito.")
        else:
            st.error("El archivo debe tener una columna llamada 'Costo'")

with tab2:
    st.subheader("Historial de Ventas")
    st.info("Aquí aparecerán todas tus cotizaciones guardadas en Google Sheets.")
